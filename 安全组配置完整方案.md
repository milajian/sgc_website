# 安全组配置完整方案

## 🎯 目标
开放云服务器 80 端口，使网站可以通过 `http://47.106.73.160` 访问。

## 📋 方案选择

### 方案一：通过控制台配置（最简单，推荐）⭐

**优点**: 无需安装工具，操作直观  
**时间**: 约 5 分钟

#### 阿里云操作步骤：

1. **登录控制台**
   - 访问：https://ecs.console.aliyun.com
   - 登录您的阿里云账号

2. **找到服务器**
   - 左侧菜单：**实例与镜像** → **实例**
   - 找到公网 IP 为 `47.106.73.160` 的实例
   - 点击实例 ID 进入详情

3. **进入安全组**
   - 在实例详情页，点击 **"安全组"** 标签
   - 点击安全组 ID（格式：`sg-xxxxx`）

4. **添加规则**
   - 点击 **"入方向"** 标签
   - 点击 **"添加安全组规则"**
   - 填写：
     ```
     规则方向: 入方向
     授权策略: 允许
     优先级: 1
     协议类型: 自定义 TCP
     端口范围: 80/80
     授权对象: 0.0.0.0/0
     描述: HTTP 访问
     ```
   - 点击 **"保存"**

5. **验证**
   - 等待 1-2 分钟
   - 访问：http://47.106.73.160

---

### 方案二：通过 CLI 配置（需要配置凭证）

**优点**: 可自动化，适合批量操作  
**前提**: 需要配置阿里云 AccessKey

#### 步骤 1: 获取 AccessKey

1. 登录阿里云控制台
2. 鼠标悬停在右上角头像
3. 选择 **"AccessKey 管理"**
4. 创建 AccessKey（如果还没有）
5. 保存 AccessKey ID 和 AccessKey Secret（**注意保密**）

#### 步骤 2: 配置 CLI

在服务器上执行：
```bash
aliyun configure
```

按提示输入：
```
Aliyun Access Key ID [None]: 您的AccessKey ID
Aliyun Access Key Secret [None]: 您的AccessKey Secret
Default Region Id [None]: cn-hangzhou（或您的区域）
Default Output Format [None]: json
```

#### 步骤 3: 运行配置脚本

```bash
bash /tmp/setup_security_group.sh
```

脚本会自动：
1. 获取实例 ID
2. 获取安全组 ID
3. 检查是否已有规则
4. 添加 80 端口规则

---

## 🔍 验证配置

### 方法一：命令行测试
```bash
curl -I http://47.106.73.160
```

应该返回：
```
HTTP/1.1 200 OK
Server: nginx/1.20.1
```

### 方法二：浏览器访问
在浏览器中打开：
```
http://47.106.73.160
```

应该能看到 SGC 网站首页。

---

## ⚠️ 常见问题

### Q1: 配置后仍然无法访问？

**检查清单**：
- [ ] 规则是否已保存（检查安全组规则列表）
- [ ] 等待 1-2 分钟（规则生效需要时间）
- [ ] 确认规则方向是"入方向"（Inbound）
- [ ] 确认协议是 TCP，端口是 80
- [ ] 确认授权对象是 0.0.0.0/0
- [ ] 检查服务器 Nginx 是否运行：`systemctl status nginx`

### Q2: 如何确认规则已生效？

在服务器上执行：
```bash
# 查看防火墙规则
iptables -L -n | grep 80

# 查看 Nginx 状态
systemctl status nginx

# 查看访问日志
tail -f /var/log/nginx/access.log
```

### Q3: 安全组规则优先级是什么？

数字越小优先级越高。通常：
- 1-100: 系统规则
- 100-1000: 用户自定义规则

建议设置为 1 或较小的数字。

### Q4: 0.0.0.0/0 是否安全？

`0.0.0.0/0` 表示允许所有 IP 访问。对于公开网站，这是正常的。

如果需要限制访问来源，可以：
- 指定特定 IP：`1.2.3.4/32`
- 指定 IP 段：`192.168.1.0/24`

---

## 📞 需要帮助？

如果按照上述步骤操作后仍然无法访问：

1. **检查服务器状态**
   ```bash
   # SSH 登录服务器
   ssh root@47.106.73.160
   
   # 检查 Nginx
   systemctl status nginx
   
   # 检查端口
   ss -tlnp | grep :80
   
   # 测试本地访问
   curl -I http://localhost
   ```

2. **查看错误日志**
   ```bash
   tail -50 /var/log/nginx/error.log
   ```

3. **联系支持**
   - 提供服务器 IP：47.106.73.160
   - 提供错误信息
   - 提供安全组配置截图

---

## ✅ 配置完成检查清单

- [ ] 已登录云服务器控制台
- [ ] 已找到服务器实例（IP: 47.106.73.160）
- [ ] 已进入安全组配置页面
- [ ] 已添加入方向规则（TCP 80 端口）
- [ ] 规则授权对象为 0.0.0.0/0
- [ ] 已保存规则
- [ ] 已等待 1-2 分钟
- [ ] 已测试访问 http://47.106.73.160
- [ ] 网站可以正常访问

---

**提示**: 推荐使用**方案一（控制台配置）**，最简单直接。配置完成后，网站即可通过 `http://47.106.73.160` 访问。


