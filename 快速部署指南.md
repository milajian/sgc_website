# ðŸš€ Nginx åå‘ä»£ç†å¿«é€Ÿéƒ¨ç½²æŒ‡å—

## å½“å‰æƒ…å†µ

ç”±äºŽ SSH è¿žæŽ¥éœ€è¦å¯†ç è®¤è¯ï¼Œè€Œè‡ªåŠ¨éƒ¨ç½²è„šæœ¬éœ€è¦äº¤äº’å¼è¾“å…¥å¯†ç ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ‰‹åŠ¨éƒ¨ç½²ã€‚

## ðŸ“‹ éƒ¨ç½²æ­¥éª¤ï¼ˆ5åˆ†é’Ÿå®Œæˆï¼‰

### æ­¥éª¤ 1: ä¸Šä¼ é…ç½®æ–‡ä»¶

åœ¨ç»ˆç«¯è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆä¼šæç¤ºè¾“å…¥å¯†ç ï¼š`Botool=300739`ï¼‰ï¼š

```bash
cd /Users/jianjian/main/sgc_website
scp nginx-main-server.conf root@47.106.73.160:/tmp/nginx-main-server.conf
```

### æ­¥éª¤ 2: SSH è¿žæŽ¥åˆ°æœåŠ¡å™¨

```bash
ssh root@47.106.73.160
```

è¾“å…¥å¯†ç ï¼š`Botool=300739`

### æ­¥éª¤ 3: åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤

å¤åˆ¶å¹¶ç²˜è´´ä»¥ä¸‹å‘½ä»¤åˆ°æœåŠ¡å™¨ç»ˆç«¯ï¼š

```bash
# 1. å¤‡ä»½çŽ°æœ‰é…ç½®ï¼ˆå¦‚æžœå­˜åœ¨ï¼‰
if [ -f /etc/nginx/sites-available/sgc_website ]; then
    cp /etc/nginx/sites-available/sgc_website /etc/nginx/sites-available/sgc_website.backup.$(date +%Y%m%d_%H%M%S)
    echo "âœ… é…ç½®å·²å¤‡ä»½"
fi

# 2. å¤åˆ¶æ–°é…ç½®
cp /tmp/nginx-main-server.conf /etc/nginx/sites-available/sgc_website
echo "âœ… é…ç½®å·²å¤åˆ¶"

# 3. åˆ›å»ºç¬¦å·é“¾æŽ¥ï¼ˆå¦‚æžœä¸å­˜åœ¨ï¼‰
if [ ! -L /etc/nginx/sites-enabled/sgc_website ]; then
    ln -s /etc/nginx/sites-available/sgc_website /etc/nginx/sites-enabled/sgc_website
    echo "âœ… ç«™ç‚¹å·²å¯ç”¨"
fi

# 4. æµ‹è¯• Nginx é…ç½®
nginx -t
echo "âœ… Nginx é…ç½®æµ‹è¯•é€šè¿‡"

# 5. é‡å¯ Nginx
systemctl reload nginx
echo "âœ… Nginx å·²é‡å¯"

# 6. æ£€æŸ¥åŽç«¯æœåŠ¡ï¼ˆç¡®ä¿åŽç«¯è¿è¡Œåœ¨ localhost:3001ï¼‰
curl http://localhost:3001/health
echo ""

# 7. æµ‹è¯• API ä»£ç†
curl http://localhost/api/experts | head -c 200
echo ""
echo "âœ… API ä»£ç†æµ‹è¯•å®Œæˆ"
```

### æ­¥éª¤ 4: éªŒè¯éƒ¨ç½²

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š
- å‰ç«¯é¦–é¡µ: http://47.106.73.160/
- ç®¡ç†åŽå°: http://47.106.73.160/admin
- API æµ‹è¯•: http://47.106.73.160/api/experts

## âš ï¸ é‡è¦æé†’

### ç¡®ä¿åŽç«¯æœåŠ¡è¿è¡Œ

åœ¨éƒ¨ç½² Nginx é…ç½®ä¹‹å‰ï¼Œç¡®ä¿åŽç«¯æœåŠ¡åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼š

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ£€æŸ¥åŽç«¯æœåŠ¡
ps aux | grep node | grep 3001

# å¦‚æžœæœªè¿è¡Œï¼Œå¯åŠ¨åŽç«¯æœåŠ¡
cd /path/to/server  # æ›¿æ¢ä¸ºå®žé™…çš„åŽç«¯ç›®å½•è·¯å¾„
npm start

# æˆ–ä½¿ç”¨ PM2ï¼ˆæŽ¨èï¼‰
pm2 start server.js --name sgc-backend
pm2 save
```

### åŽç«¯æœåŠ¡é…ç½®

ç¡®ä¿åŽç«¯æœåŠ¡ï¼š
- âœ… è¿è¡Œåœ¨ `localhost:3001` æˆ– `0.0.0.0:3001`
- âœ… ç›‘å¬ç«¯å£ 3001
- âœ… API è·¯å¾„ï¼š`/api/experts` å’Œ `/api/research-structure`

## ðŸ” æ•…éšœæŽ’æŸ¥

### é—®é¢˜ 1: Nginx é…ç½®æµ‹è¯•å¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
nginx -t

# æ£€æŸ¥é…ç½®æ–‡ä»¶
cat /etc/nginx/sites-available/sgc_website | grep -A 10 "location /api"
```

### é—®é¢˜ 2: API è¿”å›ž 502 Bad Gateway

```bash
# æ£€æŸ¥åŽç«¯æœåŠ¡
curl http://localhost:3001/health

# æ£€æŸ¥ Nginx é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/sgc_website_error.log
```

### é—®é¢˜ 3: API è¿”å›ž 404

```bash
# æ£€æŸ¥ Nginx é…ç½®
grep -A 15 "location /api" /etc/nginx/sites-available/sgc_website

# é‡æ–°åŠ è½½ Nginx
systemctl reload nginx
```

## âœ… éƒ¨ç½²å®Œæˆæ£€æŸ¥æ¸…å•

- [ ] Nginx é…ç½®å·²æ›´æ–°
- [ ] Nginx é…ç½®æµ‹è¯•é€šè¿‡
- [ ] Nginx å·²é‡å¯
- [ ] åŽç«¯æœåŠ¡è¿è¡Œæ­£å¸¸
- [ ] API ä»£ç†æµ‹è¯•é€šè¿‡
- [ ] æµè§ˆå™¨å¯ä»¥è®¿é—®ç®¡ç†åŽå°
- [ ] å¯ä»¥ä¿®æ”¹å¹¶ä¿å­˜ä¸“å®¶ä¿¡æ¯

## ðŸ“ ä¸€é”®æ‰§è¡Œè„šæœ¬ï¼ˆå¯é€‰ï¼‰

å¦‚æžœä½ æƒ³ä¸€æ¬¡æ€§æ‰§è¡Œæ‰€æœ‰å‘½ä»¤ï¼Œå¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºå¹¶è¿è¡Œï¼š

```bash
# åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºè„šæœ¬
cat > /tmp/deploy-nginx.sh << 'EOF'
#!/bin/bash
set -e

# å¤‡ä»½
if [ -f /etc/nginx/sites-available/sgc_website ]; then
    cp /etc/nginx/sites-available/sgc_website /etc/nginx/sites-available/sgc_website.backup.$(date +%Y%m%d_%H%M%S)
fi

# å¤åˆ¶é…ç½®
cp /tmp/nginx-main-server.conf /etc/nginx/sites-available/sgc_website

# å¯ç”¨ç«™ç‚¹
if [ ! -L /etc/nginx/sites-enabled/sgc_website ]; then
    ln -s /etc/nginx/sites-available/sgc_website /etc/nginx/sites-enabled/sgc_website
fi

# æµ‹è¯•å¹¶é‡å¯
nginx -t
systemctl reload nginx

echo "âœ… éƒ¨ç½²å®Œæˆï¼"
EOF

# è¿è¡Œè„šæœ¬
chmod +x /tmp/deploy-nginx.sh
/tmp/deploy-nginx.sh
```

---

**æŒ‰ç…§ä»¥ä¸Šæ­¥éª¤æ“ä½œï¼Œ5åˆ†é’Ÿå†…å³å¯å®Œæˆéƒ¨ç½²ï¼** ðŸŽ‰

