# IP Server æ„å»ºå’Œéƒ¨ç½²æŒ‡å—

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•æ„å»ºå’Œéƒ¨ç½²åç«¯æœåŠ¡å™¨ï¼ˆIP Serverï¼‰åˆ°ç”Ÿäº§ç¯å¢ƒã€‚

## ğŸ“‹ å‰ç½®è¦æ±‚

### 1. å®‰è£…ä¾èµ–å·¥å…·

**macOS:**
```bash
brew install hudochenkov/sshpass/sshpass
```

**Ubuntu/Debian:**
```bash
sudo apt-get update
sudo apt-get install sshpass rsync
```

### 2. æœåŠ¡å™¨ä¿¡æ¯é…ç½®

æœåŠ¡å™¨ä¿¡æ¯åœ¨ `deploy.config.sh` ä¸­é…ç½®ï¼Œé»˜è®¤å€¼ï¼š
- **IP åœ°å€**: 47.106.73.160
- **ç”¨æˆ·å**: root
- **å¯†ç **: Botool=300739

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ npm å‘½ä»¤ï¼ˆæ¨èï¼‰

```bash
npm run deploy:server
# æˆ–
npm run server:deploy
```

### æ–¹å¼äºŒï¼šç›´æ¥è¿è¡Œè„šæœ¬

```bash
./build-and-deploy-server.sh
```

## ğŸ“ éƒ¨ç½²æµç¨‹

è„šæœ¬ä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

1. âœ… **æ£€æŸ¥æœ¬åœ°ä»£ç ** - éªŒè¯ server ç›®å½•å’Œå¿…è¦æ–‡ä»¶å­˜åœ¨
2. ğŸ”§ **æ£€æŸ¥ä¾èµ–å·¥å…·** - éªŒè¯ sshpassã€rsync ç­‰å·¥å…·å·²å®‰è£…
3. ğŸ”Œ **æµ‹è¯•è¿æ¥** - éªŒè¯æœåŠ¡å™¨è¿æ¥æ˜¯å¦æ­£å¸¸
4. ğŸ“ **åˆ›å»ºç›®å½•** - åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºå¿…è¦çš„ç›®å½•ç»“æ„
5. ğŸ“¤ **ä¸Šä¼ æ–‡ä»¶** - ä½¿ç”¨ rsync ä¸Šä¼ åç«¯ä»£ç ï¼ˆæ’é™¤ node_modulesï¼‰
6. ğŸ“¦ **å®‰è£…ä¾èµ–** - åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ `npm install --production`
7. ğŸ”„ **æ£€æŸ¥ PM2** - æ£€æŸ¥å¹¶å®‰è£… PM2ï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
8. ğŸš€ **å¯åŠ¨æœåŠ¡** - ä½¿ç”¨ PM2 å¯åŠ¨æˆ–é‡å¯åç«¯æœåŠ¡
9. âœ… **éªŒè¯æœåŠ¡** - æµ‹è¯•å¥åº·æ£€æŸ¥å’Œ API ç«¯ç‚¹

## ğŸ”§ é…ç½®è¯´æ˜

### æœåŠ¡å™¨é…ç½®

ç¼–è¾‘ `deploy.config.sh` å¯ä»¥è‡ªå®šä¹‰ä»¥ä¸‹é…ç½®ï¼š

```bash
# æœåŠ¡å™¨ä¿¡æ¯
export DEPLOY_HOST="47.106.73.160"
export DEPLOY_USER="root"
export DEPLOY_PASSWORD="Botool=300739"

# éƒ¨ç½²è·¯å¾„
export REMOTE_BASE_DIR="/var/www/sgc_website"
export REMOTE_SERVER_DIR="${REMOTE_BASE_DIR}/server"
```

### SSH å¯†é’¥è®¤è¯ï¼ˆæ¨èï¼‰

é…ç½® SSH å¯†é’¥åï¼Œéƒ¨ç½²å°†è‡ªåŠ¨ä½¿ç”¨å¯†é’¥è®¤è¯ï¼š

```bash
npm run deploy:setup-ssh
```

## ğŸ“ ç›®å½•ç»“æ„

éƒ¨ç½²åçš„æœåŠ¡å™¨ç›®å½•ç»“æ„ï¼š

```
/var/www/sgc_website/server/
â”œâ”€â”€ server.js              # ä¸»æœåŠ¡å™¨æ–‡ä»¶
â”œâ”€â”€ package.json           # ä¾èµ–é…ç½®
â”œâ”€â”€ package-lock.json      # é”å®šæ–‡ä»¶
â”œâ”€â”€ api/                   # API è·¯ç”±
â”‚   â”œâ”€â”€ experts.js
â”‚   â””â”€â”€ research-structure.js
â”œâ”€â”€ data/                  # æ•°æ®æ–‡ä»¶
â”‚   â”œâ”€â”€ experts.json
â”‚   â””â”€â”€ research-structure.json
â”œâ”€â”€ uploads/               # ä¸Šä¼ çš„æ–‡ä»¶
â””â”€â”€ node_modules/          # ä¾èµ–åŒ…ï¼ˆæœåŠ¡å™¨ä¸Šå®‰è£…ï¼‰
```

## ğŸŒ æœåŠ¡ä¿¡æ¯

éƒ¨ç½²å®Œæˆåï¼Œåç«¯æœåŠ¡ä¿¡æ¯ï¼š

- **æœåŠ¡å™¨åœ°å€**: http://47.106.73.160:3001
- **å¥åº·æ£€æŸ¥**: http://47.106.73.160:3001/health
- **API ç«¯ç‚¹**: 
  - http://47.106.73.160:3001/api/experts
  - http://47.106.73.160:3001/api/research-structure
- **å‰ç«¯ä»£ç†**: http://47.106.73.160/api/expertsï¼ˆé€šè¿‡ Nginxï¼‰

## ğŸ“ PM2 ç®¡ç†å‘½ä»¤

```bash
# SSH åˆ°æœåŠ¡å™¨
ssh root@47.106.73.160

# æŸ¥çœ‹æœåŠ¡åˆ—è¡¨
pm2 list

# æŸ¥çœ‹æ—¥å¿—
pm2 logs sgc-backend

# é‡å¯æœåŠ¡
pm2 restart sgc-backend

# åœæ­¢æœåŠ¡
pm2 stop sgc-backend

# ç›‘æ§æœåŠ¡
pm2 monit

# æŸ¥çœ‹æœåŠ¡è¯¦æƒ…
pm2 info sgc-backend
```

## ğŸ” éªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
ssh root@47.106.73.160 "pm2 list"
```

åº”è¯¥çœ‹åˆ° `sgc-backend` æœåŠ¡çŠ¶æ€ä¸º `online`ã€‚

### 2. æµ‹è¯•å¥åº·æ£€æŸ¥

```bash
curl http://47.106.73.160:3001/health
```

åº”è¯¥è¿”å›ï¼š
```json
{"status":"ok","message":"Server is running"}
```

### 3. æµ‹è¯• API ç«¯ç‚¹

```bash
curl http://47.106.73.160:3001/api/experts
```

åº”è¯¥è¿”å›ä¸“å®¶åˆ—è¡¨æ•°æ®ï¼ˆJSON æ ¼å¼ï¼‰ã€‚

### 4. æµ‹è¯•å‰ç«¯ä»£ç†

```bash
curl http://47.106.73.160/api/experts
```

åº”è¯¥é€šè¿‡ Nginx ä»£ç†è¿”å›ç›¸åŒçš„æ•°æ®ã€‚

## â“ æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šsshpass æœªæ‰¾åˆ°

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# macOS
brew install hudochenkov/sshpass/sshpass

# Ubuntu/Debian
sudo apt-get install sshpass
```

### é—®é¢˜ï¼šè¿æ¥è¶…æ—¶

**æ£€æŸ¥ï¼š**
1. æœåŠ¡å™¨ IP åœ°å€æ˜¯å¦æ­£ç¡®
2. æœåŠ¡å™¨æ˜¯å¦å¯è®¿é—®ï¼ˆping æµ‹è¯•ï¼‰
3. é˜²ç«å¢™æ˜¯å¦å…è®¸ SSH è¿æ¥

### é—®é¢˜ï¼šæœåŠ¡å¯åŠ¨å¤±è´¥

**æ£€æŸ¥ï¼š**
1. Node.js æ˜¯å¦å·²å®‰è£…ï¼š`node --version`
2. ä¾èµ–æ˜¯å¦å®‰è£…æˆåŠŸï¼šæ£€æŸ¥ `node_modules` ç›®å½•
3. ç«¯å£ 3001 æ˜¯å¦è¢«å ç”¨ï¼š`lsof -i :3001`
4. æŸ¥çœ‹ PM2 æ—¥å¿—ï¼š`pm2 logs sgc-backend`

### é—®é¢˜ï¼šAPI è¿”å› 502 é”™è¯¯

**æ£€æŸ¥ï¼š**
1. åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œï¼š`pm2 list`
2. Nginx é…ç½®æ˜¯å¦æ­£ç¡®ï¼šæ£€æŸ¥ `/etc/nginx/sites-available/sgc_website`
3. Nginx æ˜¯å¦è¿è¡Œï¼š`systemctl status nginx`

## ğŸ”’ å®‰å…¨å»ºè®®

1. **ä½¿ç”¨ SSH å¯†é’¥è®¤è¯**ï¼šé…ç½®å®Œæˆåï¼Œå»ºè®®ä½¿ç”¨ SSH å¯†é’¥è€Œéå¯†ç 
2. **ä¿æŠ¤é…ç½®æ–‡ä»¶**ï¼šä¸è¦å°†åŒ…å«å¯†ç çš„é…ç½®æ–‡ä»¶æäº¤åˆ°å…¬å…±ä»“åº“
3. **å®šæœŸæ›´æ–°å¯†ç **ï¼šå®šæœŸæ›´æ¢æœåŠ¡å™¨å¯†ç 
4. **é™åˆ¶ç«¯å£è®¿é—®**ï¼šåœ¨æœåŠ¡å™¨ä¸Šé…ç½®é˜²ç«å¢™ï¼Œåªå…è®¸å¿…è¦çš„ç«¯å£è®¿é—®

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [éƒ¨ç½²æŒ‡å—](./DEPLOY.md) - å‰ç«¯éƒ¨ç½²æŒ‡å—
- [Nginx é…ç½®æŒ‡å—](./Nginxåå‘ä»£ç†éƒ¨ç½²æŒ‡å—.md) - Nginx åå‘ä»£ç†é…ç½®

